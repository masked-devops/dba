<?xml version="1.0" encoding="UTF-8" ?>
<displays>
<display id="3232034d-015e-1000-8002-0b0e12972947" type="" style="Table" enable="true">
	<name><![CDATA[masked-devops AWR reports]]></name>
	<description><![CDATA[]]></description>
	<tooltip><![CDATA[]]></tooltip>
	<drillclass><![CDATA[]]></drillclass>
	<CustomValues>
		<TYPE><![CDATA[horizontal]]></TYPE>
	</CustomValues>
	<query>
		<sql><![CDATA[-- -----------------------------------------------------------------------------
-- Author      : Masked DevOps
-- Date        : Jan 2012
-- Version     : 0.2
-- -----------------------------------------------------------------------------

with
	 parms as ( select
                     nvl(:reports_dest_dir,'c:\temp')                                   reports_dest_dir
                    ,case when instr(:reports_dest_dir,'\') > 0 then '\' else '/' end   slash
                from dual)
select
	 snap_id start_snap_id
	,to_char(end_interval_time,'yyyy-mm-dd_hh24.mi.ss')	 start_snap_date
	,db_name
	,instance_name
	,dbid
	,instance_number
    ,reports_dest_dir
    --,slash
from (	select
			 di.db_name
			,di.instance_name
			,s.snap_id
			,lag(snap_id) over (partition by s.dbid,di.db_name,di.instance_number order by snap_id) as snap_id_prev
			,s.end_interval_time
			,di.dbid
			,di.instance_number
		from dba_hist_snapshot s, dba_hist_database_instance di
		where 1=1
			and s.dbid				  = di.dbid(+)
			and s.instance_number	  = di.instance_number(+)
			and s.startup_time		  = di.startup_time(+)
	) snaps,parms
where snap_id_prev is not null
order by end_interval_time ,instance_number, snap_id]]></sql>
		<binds>
			<bind id="reports_dest_dir">
				<prompt><![CDATA[reports_dest_dir]]></prompt>
				<tooltip><![CDATA[reports_dest_dir]]></tooltip>
				<value><![CDATA[F:\work\temp\awr]]></value>
				<bracket><![CDATA[null]]></bracket>
			</bind>
		</binds>
	</query>
		<pdf version="VERSION_1_7" compression="CONTENT">
			<docproperty title="" author="" subject="" keywords="" />
			<cell toppadding="2" bottompadding="2" leftpadding="2" rightpadding="2" horizontalalign="LEFT" verticalalign="TOP" wrap="true" />
			<column>
				<heading font="null" size="10" style="NORMAL" color="-16777216" rowshading="-1" labeling="FIRST_PAGE" />
				<footing font="null" size="10" style="NORMAL" color="-16777216" rowshading="-1" labeling="NONE" />
				<blob blob="NONE" zip="false" />
			</column>
			<table font="null" size="10" style="NORMAL" color="-16777216" userowshading="false" oddrowshading="-1" evenrowshading="-1" showborders="true" spacingbefore="12" spacingafter="12" horizontalalign="LEFT" />
			<header enable="false" generatedate="false">
				<data>
				
				
				
				
				
				
				
				
				
				
				
				
				
					
					
					
					
					
					
					
					
					
				
				
				
				
				

















































































				null																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																							</data>
			</header>
			<footer enable="false" generatedate="false">
				<data value="null" />
			</footer>
			<pagesetup papersize="LETTER" orientation="1" measurement="in" margintop="1.0" marginbottom="1.0" marginleft="1.0" marginright="1.0" />
		</pdf>
	<display id="3232034d-015e-1000-8002-0b0e12972947" type="" style="Table" enable="true">
		<name><![CDATA[End Snap]]></name>
		<description><![CDATA[]]></description>
		<tooltip><![CDATA[]]></tooltip>
		<drillclass><![CDATA[]]></drillclass>
		<CustomValues>
			<TYPE><![CDATA[horizontal]]></TYPE>
		</CustomValues>
		<query>
			<sql><![CDATA[select
					 s.snap_id end_snap_id
					,to_char(s.end_interval_time,'yyyy-mm-dd_hh24.mi.ss')  end_snap_date
					,di.db_name
					,di.instance_name
					,di.dbid
					,di.instance_number
					,:START_SNAP_ID start_snap_id
					,:START_SNAP_DATE  start_snap_date
					,'set echo off feedback on linesize 4000 long 100000 trimspool on pagesize 0 heading off time off timing off serveroutput on verify off termout off' ||
						chr(10) || 'spool awr_report_'||:DB_NAME||'.'||di.instance_name||'.'||:START_SNAP_DATE||'--'||to_char(s.end_interval_time,'yyyy-mm-dd_hh24.mi.ss')||'.'||'txt;' ||
						chr(10) || 'select output from table(dbms_workload_repository.awr_report_text('||:DBID||','||di.instance_number||','||:START_SNAP_ID||','||s.snap_id||'));' ||
						chr(10) || 'spool off' awr_report_text
					,'set echo off feedback on linesize 4000 long 100000 trimspool on pagesize 0 heading off time off timing off serveroutput on verify off termout off' ||
						chr(10) || 'spool awr_report_'||:DB_NAME||'.'||di.instance_name||'.'||:START_SNAP_DATE||'--'||to_char(s.end_interval_time,'yyyy-mm-dd_hh24.mi.ss')||'.'||'html;' ||
						chr(10) || 'select output from table(dbms_workload_repository.awr_report_html('||:DBID||','||di.instance_number||','||:START_SNAP_ID||','||s.snap_id||'));' ||
						chr(10) || 'spool off' awr_report_html
					,'set echo off feedback on linesize 4000 long 100000 trimspool on pagesize 0 heading off time off timing off serveroutput on verify off termout off' ||
						chr(10) || 'spool awr_report_'||:DB_NAME||'.'||'global'||'.'||:START_SNAP_DATE||'--'||to_char(s.end_interval_time,'yyyy-mm-dd_hh24.mi.ss')||'.'||'txt;' ||
						chr(10) || 'select output from table(dbms_workload_repository.awr_global_report_text('||:DBID||','||''''''||','||:START_SNAP_ID||','||s.snap_id||'));' ||
						chr(10) || 'spool off' awr_global_report_text
					,'set echo off feedback on linesize 4000 long 100000 trimspool on pagesize 0 heading off time off timing off serveroutput on verify off termout off' ||
						chr(10) || 'spool awr_report_'||:DB_NAME||'.'||'global'||'.'||:START_SNAP_DATE||'--'||to_char(s.end_interval_time,'yyyy-mm-dd_hh24.mi.ss')||'.'||'html;' ||
						chr(10) || 'select output from table(dbms_workload_repository.awr_global_report_html('||:DBID||','||''''''||','||:START_SNAP_ID||','||s.snap_id||'));' ||
						chr(10) || 'spool off' awr_global_report_html
					,'set echo off feedback on linesize 4000 long 100000 trimspool on pagesize 0 heading off time off timing off serveroutput on verify off termout off' ||
						chr(10) || 'spool ash_report_'||:DB_NAME||'.'||di.instance_name||'.'||:START_SNAP_DATE||'--'||to_char(s.end_interval_time,'yyyy-mm-dd_hh24.mi.ss')||'.'||'txt;' ||
						chr(10) || 'select output from table(dbms_workload_repository.ash_report_text('||:DBID||','||di.instance_number||','||'to_date('''||:START_SNAP_DATE||''',''yyyy-mm-dd hh24:mi:ss'')'||','||'to_date('''||to_char(s.end_interval_time,'yyyy-mm-dd_hh24.mi.ss')||''',''yyyy-mm-dd hh24:mi:ss'')'||'));' ||
						chr(10) || 'spool off' ash_report_text
					,'set echo off feedback on linesize 4000 long 100000 trimspool on pagesize 0 heading off time off timing off serveroutput on verify off termout off' ||
						chr(10) || 'spool ash_report_'||:DB_NAME||'.'||di.instance_name||'.'||:START_SNAP_DATE||'--'||to_char(s.end_interval_time,'yyyy-mm-dd_hh24.mi.ss')||'.'||'html;' ||
						chr(10) || 'select output from table(dbms_workload_repository.ash_report_html('||:DBID||','||di.instance_number||','||'to_date('''||:START_SNAP_DATE||''',''yyyy-mm-dd hh24:mi:ss'')'||','||'to_date('''||to_char(s.end_interval_time,'yyyy-mm-dd_hh24.mi.ss')||''',''yyyy-mm-dd hh24:mi:ss'')'||'));' ||
						chr(10) || 'spool off' ash_report_html
					,'set echo off feedback on linesize 4000 long 100000 trimspool on pagesize 0 heading off time off timing off serveroutput on verify off termout off' ||
						chr(10) || 'spool ash_report_'||:DB_NAME||'.'||'global'||'.'||:START_SNAP_DATE||'--'||to_char(s.end_interval_time,'yyyy-mm-dd_hh24.mi.ss')||'.'||'txt;' ||
						chr(10) || 'select output from table(dbms_workload_repository.ash_global_report_text('||:DBID||','||''''''||','||'to_date('''||:START_SNAP_DATE||''',''yyyy-mm-dd hh24:mi:ss'')'||','||'to_date('''||to_char(s.end_interval_time,'yyyy-mm-dd_hh24.mi.ss')||''',''yyyy-mm-dd hh24:mi:ss'')'||'));' ||
						chr(10) || 'spool off' ash_global_report_text
					,'set echo off feedback on linesize 4000 long 100000 trimspool on pagesize 0 heading off time off timing off serveroutput on verify off termout off' ||
						chr(10) || 'spool ash_report_'||:DB_NAME||'.'||'global'||'.'||:START_SNAP_DATE||'--'||to_char(s.end_interval_time,'yyyy-mm-dd_hh24.mi.ss')||'.'||'html;' ||
						chr(10) || 'select output from table(dbms_workload_repository.ash_global_report_html('||:DBID||','||''''''||','||'to_date('''||:START_SNAP_DATE||''',''yyyy-mm-dd hh24:mi:ss'')'||','||'to_date('''||to_char(s.end_interval_time,'yyyy-mm-dd_hh24.mi.ss')||''',''yyyy-mm-dd hh24:mi:ss'')'||'));' ||
						chr(10) || 'spool off' ash_global_report_html
				from dba_hist_snapshot s, dba_hist_database_instance di
				where 1=1
					and s.dbid				  = di.dbid(+)
					and s.instance_number	  = di.instance_number(+)
					and s.startup_time		  = di.startup_time(+)
					and s.dbid				  = :DBID
					and s.instance_number	  = :INSTANCE_NUMBER
					and cast(s.end_interval_time as date) > to_date(:START_SNAP_DATE,'yyyy-mm-dd hh24:mi:ss')
			order by end_interval_time ,instance_name, snap_id]]></sql>
			<binds>
				<bind id="START_SNAP_ID">
					<prompt><![CDATA[START_SNAP_ID]]></prompt>
					<tooltip><![CDATA[START_SNAP_ID]]></tooltip>
					<value><![CDATA[NULL_VALUE]]></value>
					<bracket><![CDATA[null]]></bracket>
				</bind>
				<bind id="START_SNAP_DATE">
					<prompt><![CDATA[START_SNAP_DATE]]></prompt>
					<tooltip><![CDATA[START_SNAP_DATE]]></tooltip>
					<value><![CDATA[NULL_VALUE]]></value>
					<bracket><![CDATA[null]]></bracket>
				</bind>
				<bind id="DB_NAME">
					<prompt><![CDATA[DB_NAME]]></prompt>
					<tooltip><![CDATA[DB_NAME]]></tooltip>
					<value><![CDATA[NULL_VALUE]]></value>
					<bracket><![CDATA[null]]></bracket>
				</bind>
				<bind id="DBID">
					<prompt><![CDATA[DBID]]></prompt>
					<tooltip><![CDATA[DBID]]></tooltip>
					<value><![CDATA[NULL_VALUE]]></value>
					<bracket><![CDATA[null]]></bracket>
				</bind>
				<bind id="INSTANCE_NUMBER">
					<prompt><![CDATA[INSTANCE_NUMBER]]></prompt>
					<tooltip><![CDATA[INSTANCE_NUMBER]]></tooltip>
					<value><![CDATA[NULL_VALUE]]></value>
					<bracket><![CDATA[null]]></bracket>
				</bind>
			</binds>
		</query>
			<pdf version="VERSION_1_7" compression="CONTENT">
				<docproperty title="" author="" subject="" keywords="" />
				<cell toppadding="2" bottompadding="2" leftpadding="2" rightpadding="2" horizontalalign="LEFT" verticalalign="TOP" wrap="true" />
				<column>
					<heading font="null" size="10" style="NORMAL" color="-16777216" rowshading="-1" labeling="FIRST_PAGE" />
					<footing font="null" size="10" style="NORMAL" color="-16777216" rowshading="-1" labeling="NONE" />
					<blob blob="NONE" zip="false" />
				</column>
				<table font="null" size="10" style="NORMAL" color="-16777216" userowshading="false" oddrowshading="-1" evenrowshading="-1" showborders="true" spacingbefore="12" spacingafter="12" horizontalalign="LEFT" />
				<header enable="false" generatedate="false">
					<data>
					
					
					
					
					
					
					
					
					
					
					
					
					
						
						
						
						
						
						
						
						
						
					
					
					
					
					

















































































						null																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																												</data>
				</header>
				<footer enable="false" generatedate="false">
					<data value="null" />
				</footer>
				<pagesetup papersize="LETTER" orientation="1" measurement="in" margintop="1.0" marginbottom="1.0" marginleft="1.0" marginright="1.0" />
			</pdf>
		<display id="" type="" style="Table" enable="true">
			<name><![CDATA[Info]]></name>
			<description><![CDATA[]]></description>
			<tooltip><![CDATA[]]></tooltip>
			<drillclass><![CDATA[]]></drillclass>
			<CustomValues>
				<TYPE><![CDATA[horizontal]]></TYPE>
			</CustomValues>
			<query>
				<sql><![CDATA[select
													 :START_SNAP_ID start_snap_id
													,:END_SNAP_ID end_snap_id
													,:START_SNAP_DATE start_snap_date
													,:END_SNAP_DATE end_snap_date
													,:DB_NAME db_name
													,:INSTANCE_NAME instance_name
													,:INSTANCE_NUMBER instance_number
													,'awr_report_'||:DB_NAME||'.'||:INSTANCE_NAME||'.'||:START_SNAP_DATE||'--'||:END_SNAP_DATE||'.'||'txt;'	 awr_txt
													,'awr_report_'||:DB_NAME||'.'||:INSTANCE_NAME||'.'||:START_SNAP_DATE||'--'||:END_SNAP_DATE||'.'||'html;' awr_html
													,'awr_report_'||:DB_NAME||'.'||'global'||'.'||:START_SNAP_DATE||'--'||:END_SNAP_DATE||'.'||'txt;'		 awr_global_txt
													,'awr_report_'||:DB_NAME||'.'||'global'||'.'||:START_SNAP_DATE||'--'||:END_SNAP_DATE||'.'||'html;'		 awr_global_html
													,'ash_report_'||:DB_NAME||'.'||:INSTANCE_NAME||'.'||:START_SNAP_DATE||'--'||:END_SNAP_DATE||'.'||'txt;'	 ash_txt
													,'ash_report_'||:DB_NAME||'.'||:INSTANCE_NAME||'.'||:START_SNAP_DATE||'--'||:END_SNAP_DATE||'.'||'html;' ash_html
													,'ash_report_'||:DB_NAME||'.'||'global'||'.'||:START_SNAP_DATE||'--'||:END_SNAP_DATE||'.'||'txt;'		 ash_global_txt
													,'ash_report_'||:DB_NAME||'.'||'global'||'.'||:START_SNAP_DATE||'--'||:END_SNAP_DATE||'.'||'html;'		 ash_global_html
													from dual;]]></sql>
				<binds>
					<bind id="START_SNAP_ID">
						<prompt><![CDATA[START_SNAP_ID]]></prompt>
						<tooltip><![CDATA[START_SNAP_ID]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="END_SNAP_ID">
						<prompt><![CDATA[END_SNAP_ID]]></prompt>
						<tooltip><![CDATA[END_SNAP_ID]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="START_SNAP_DATE">
						<prompt><![CDATA[START_SNAP_DATE]]></prompt>
						<tooltip><![CDATA[START_SNAP_DATE]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="END_SNAP_DATE">
						<prompt><![CDATA[END_SNAP_DATE]]></prompt>
						<tooltip><![CDATA[END_SNAP_DATE]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="DB_NAME">
						<prompt><![CDATA[DB_NAME]]></prompt>
						<tooltip><![CDATA[DB_NAME]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="INSTANCE_NAME">
						<prompt><![CDATA[INSTANCE_NAME]]></prompt>
						<tooltip><![CDATA[INSTANCE_NAME]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="INSTANCE_NUMBER">
						<prompt><![CDATA[INSTANCE_NUMBER]]></prompt>
						<tooltip><![CDATA[INSTANCE_NUMBER]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
				</binds>
			</query>
				<pdf version="VERSION_1_7" compression="CONTENT">
					<docproperty title="" author="" subject="" keywords="" />
					<cell toppadding="2" bottompadding="2" leftpadding="2" rightpadding="2" horizontalalign="LEFT" verticalalign="TOP" wrap="true" />
					<column>
						<heading font="null" size="10" style="NORMAL" color="-16777216" rowshading="-1" labeling="FIRST_PAGE" />
						<footing font="null" size="10" style="NORMAL" color="-16777216" rowshading="-1" labeling="NONE" />
						<blob blob="NONE" zip="false" />
					</column>
					<table font="null" size="10" style="NORMAL" color="-16777216" userowshading="false" oddrowshading="-1" evenrowshading="-1" showborders="true" spacingbefore="12" spacingafter="12" horizontalalign="LEFT" />
					<header enable="false" generatedate="false">
						<data>
						
						
						
						
						
						
						
						
						
						
						
						
						
							
							
							
							
							
							
							
							
							
						
						
						
						
						

















































































														null																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																					</data>
					</header>
					<footer enable="false" generatedate="false">
						<data value="null" />
					</footer>
					<pagesetup papersize="LETTER" orientation="1" measurement="in" margintop="1.0" marginbottom="1.0" marginleft="1.0" marginright="1.0" />
				</pdf>
		</display>
		<display id="" type="" style="Script" enable="true">
			<name><![CDATA[AWR html]]></name>
			<description><![CDATA[]]></description>
			<tooltip><![CDATA[]]></tooltip>
			<drillclass><![CDATA[]]></drillclass>
			<CustomValues>
			</CustomValues>
			<query>
				<sql><![CDATA[
													prompt Running....
													set echo off feedback on linesize 4000 long 100000 trimspool on pagesize 0 heading off time off timing off serveroutput on verify off termout off
													column filename new_value filename
													select  :REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'awr_report_'||:DB_NAME||'.'||:INSTANCE_NAME||'.'||:START_SNAP_DATE||'--'||:END_SNAP_DATE||'.'||:START_SNAP_ID||'-'||:END_SNAP_ID||'.html' filename from dual;
													spool &filename
													select output from table(dbms_workload_repository.awr_report_html(:DBID,:INSTANCE_NUMBER,:START_SNAP_ID,:END_SNAP_ID));
													spool off
													set termout on heading on feedback off
													prompt &filename
													]]></sql>
				<binds>
					<bind id="DB_NAME">
						<prompt><![CDATA[DB_NAME]]></prompt>
						<tooltip><![CDATA[DB_NAME]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="INSTANCE_NAME">
						<prompt><![CDATA[INSTANCE_NAME]]></prompt>
						<tooltip><![CDATA[INSTANCE_NAME]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="START_SNAP_DATE">
						<prompt><![CDATA[START_SNAP_DATE]]></prompt>
						<tooltip><![CDATA[START_SNAP_DATE]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="END_SNAP_DATE">
						<prompt><![CDATA[END_SNAP_DATE]]></prompt>
						<tooltip><![CDATA[END_SNAP_DATE]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="START_SNAP_ID">
						<prompt><![CDATA[START_SNAP_ID]]></prompt>
						<tooltip><![CDATA[START_SNAP_ID]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="END_SNAP_ID">
						<prompt><![CDATA[END_SNAP_ID]]></prompt>
						<tooltip><![CDATA[END_SNAP_ID]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="DBID">
						<prompt><![CDATA[DBID]]></prompt>
						<tooltip><![CDATA[DBID]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="INSTANCE_NUMBER">
						<prompt><![CDATA[INSTANCE_NUMBER]]></prompt>
						<tooltip><![CDATA[INSTANCE_NUMBER]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
				</binds>
			</query>
		</display>
		<display id="" type="" style="Script" enable="true">
			<name><![CDATA[ASH html]]></name>
			<description><![CDATA[]]></description>
			<tooltip><![CDATA[]]></tooltip>
			<drillclass><![CDATA[]]></drillclass>
			<CustomValues>
			</CustomValues>
			<query>
				<sql><![CDATA[
													prompt Running....
													set echo off feedback on linesize 4000 long 100000 trimspool on pagesize 0 heading off time off timing off serveroutput on verify off termout off
													column filename new_value filename
													select  :REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'ash_report_'||:DB_NAME||'.'||:INSTANCE_NAME||'.'||:START_SNAP_DATE||'--'||:END_SNAP_DATE||'.'||:START_SNAP_ID||'-'||:END_SNAP_ID||'.html' filename from dual;
													spool &filename
													select output from table(dbms_workload_repository.ash_report_html(:DBID,:INSTANCE_NUMBER,to_date(:START_SNAP_DATE,'yyyy-mm-dd hh24:mi:ss'),to_date(:END_SNAP_DATE,'yyyy-mm-dd_hh24.mi.ss')));
													spool off
													set termout on heading on feedback off
													prompt &filename
												]]></sql>
				<binds>
					<bind id="DB_NAME">
						<prompt><![CDATA[DB_NAME]]></prompt>
						<tooltip><![CDATA[DB_NAME]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="INSTANCE_NAME">
						<prompt><![CDATA[INSTANCE_NAME]]></prompt>
						<tooltip><![CDATA[INSTANCE_NAME]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="START_SNAP_DATE">
						<prompt><![CDATA[START_SNAP_DATE]]></prompt>
						<tooltip><![CDATA[START_SNAP_DATE]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="END_SNAP_DATE">
						<prompt><![CDATA[END_SNAP_DATE]]></prompt>
						<tooltip><![CDATA[END_SNAP_DATE]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="START_SNAP_ID">
						<prompt><![CDATA[START_SNAP_ID]]></prompt>
						<tooltip><![CDATA[START_SNAP_ID]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="END_SNAP_ID">
						<prompt><![CDATA[END_SNAP_ID]]></prompt>
						<tooltip><![CDATA[END_SNAP_ID]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="DBID">
						<prompt><![CDATA[DBID]]></prompt>
						<tooltip><![CDATA[DBID]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="INSTANCE_NUMBER">
						<prompt><![CDATA[INSTANCE_NUMBER]]></prompt>
						<tooltip><![CDATA[INSTANCE_NUMBER]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
				</binds>
			</query>
		</display>
		<display id="" type="" style="Script" enable="true">
			<name><![CDATA[ADDM text]]></name>
			<description><![CDATA[]]></description>
			<tooltip><![CDATA[]]></tooltip>
			<drillclass><![CDATA[]]></drillclass>
			<CustomValues>
			</CustomValues>
			<query>
				<sql><![CDATA[
													set echo off feedback on linesize 4000 long 100000 trimspool on pagesize 0 heading off time off timing off serveroutput on verify off termout off
													column filename new_value filename
													select  :REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'addm_report_'||:DB_NAME||'.'||:INSTANCE_NAME||'.'||:START_SNAP_DATE||'--'||:END_SNAP_DATE||'.'||:START_SNAP_ID||'-'||:END_SNAP_ID||'.html' filename from dual;
													spool &filename
													select dbms_advisor.get_task_report('ADDM:'||:DBID||'_'||:INSTANCE_NUMBER||'_'||:END_SNAP_ID,'TEXT','ALL','ALL','SYS') as report  FROM	  dual;													   set termout on heading on feedback off
													spool off
													set termout on heading on feedback off
													prompt &filename
												]]></sql>
				<binds>
					<bind id="DB_NAME">
						<prompt><![CDATA[DB_NAME]]></prompt>
						<tooltip><![CDATA[DB_NAME]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="INSTANCE_NAME">
						<prompt><![CDATA[INSTANCE_NAME]]></prompt>
						<tooltip><![CDATA[INSTANCE_NAME]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="START_SNAP_DATE">
						<prompt><![CDATA[START_SNAP_DATE]]></prompt>
						<tooltip><![CDATA[START_SNAP_DATE]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="END_SNAP_DATE">
						<prompt><![CDATA[END_SNAP_DATE]]></prompt>
						<tooltip><![CDATA[END_SNAP_DATE]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="START_SNAP_ID">
						<prompt><![CDATA[START_SNAP_ID]]></prompt>
						<tooltip><![CDATA[START_SNAP_ID]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="END_SNAP_ID">
						<prompt><![CDATA[END_SNAP_ID]]></prompt>
						<tooltip><![CDATA[END_SNAP_ID]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="DBID">
						<prompt><![CDATA[DBID]]></prompt>
						<tooltip><![CDATA[DBID]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="INSTANCE_NUMBER">
						<prompt><![CDATA[INSTANCE_NUMBER]]></prompt>
						<tooltip><![CDATA[INSTANCE_NUMBER]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
				</binds>
			</query>
		</display>
		<display id="" type="" style="Script" enable="true">
			<name><![CDATA[All AWR]]></name>
			<description><![CDATA[]]></description>
			<tooltip><![CDATA[]]></tooltip>
			<drillclass><![CDATA[]]></drillclass>
			<CustomValues>
			</CustomValues>
			<query>
				<sql><![CDATA[
set echo off feedback off linesize 4000 long 100000 trimspool on pagesize 0 heading off time off timing off serveroutput on verify off termout on
--define variables
col create_sql_file new_value create_sql_file
select  :REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'create_reports.sql' create_sql_file from dual;

var date_format      varchar2(40)
exec :date_format := 'yyyy-mm-dd_hh24.mi.ss'


-- create sql file
spool "&CREATE_SQL_FILE"
prompt set echo off feedback on linesize 4000 long 100000 trimspool on pagesize 0 heading off time off timing off serveroutput on verify off termout off
with
    report_type as (
                    select 'awr_report_html' awr_report from dual
                    ),
    db as (
                    select distinct dbid from  dba_hist_snapshot 
                    where 1=1
                        and cast(begin_interval_time as date) < to_date(:END_SNAP_DATE,'yyyy-mm-dd hh24:mi:ss')
                        and cast(end_interval_time as date)   > to_date(:START_SNAP_DATE,'yyyy-mm-dd hh24:mi:ss')
    ),
    snaps as
                (select
                    d.name  dbname
                    ,i.instance_name
                    ,s.snap_id
                    ,snap_id_prev
                    ,d.dbid
                    ,i.instance_number
                    ,to_char(s.begin_interval_time,:date_format) begin_interval_time
                    ,to_char(s.end_interval_time,:date_format)   end_interval_time
                    ,min(to_char(s.begin_interval_time,:date_format)) over (partition by rt.awr_report) min_begin_interval_time
                    ,max(to_char(s.end_interval_time,:date_format))   over (partition by rt.awr_report) max_end_interval_time
                    ,max(snap_id) over (partition by rt.awr_report)     max_snap_id
                    ,min(snap_id_prev) over(partition by rt.awr_report) min_snap_id
                    ,rt.awr_report
                from (select dhs.*,lag(snap_id) over (order by snap_id) as snap_id_prev from dba_hist_snapshot dhs, db where instance_number = :INSTANCE_NUMBER and dhs.dbid = db.dbid) s
                        ,dba_hist_database_instance di, v$database d, v$instance i, report_type rt
                where di.dbid                 = s.dbid
                    and di.dbid               = d.dbid
                    and di.instance_number    = s.instance_number
                    and di.instance_number    = i.instance_number
                    and di.startup_time       = s.startup_time
					and cast(s.begin_interval_time as date) < to_date(:END_SNAP_DATE,'yyyy-mm-dd hh24:mi:ss')
                    --and s.begin_interval_time < to_date(:end_date,:date_format)
					and cast(s.end_interval_time as date) > to_date(:START_SNAP_DATE,'yyyy-mm-dd hh24:mi:ss')
                    --and s.end_interval_time   > to_date(:start_date,:date_format)
                )
select distinct
    case awr_report
        when 'awr_report_text' then
            'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'awr_report_'||dbname||'.'||instance_name||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'txt' ||
                chr(10) || 'select output from table(dbms_workload_repository.awr_report_text('||dbid||','||instance_number||','||snap_id_prev||','||snap_id||'));' ||
                chr(10) || 'spool off'
        when 'awr_report_html' then
            'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'awr_report_'||dbname||'.'||instance_name||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'html' ||
                chr(10) || 'select output from table(dbms_workload_repository.awr_report_html('||dbid||','||instance_number||','||snap_id_prev||','||snap_id||'));' ||
                chr(10) || 'spool off'
        when 'awr_global_report_text' then
            'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'awr_report_'||dbname||'.'||'global'||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'txt' ||
                chr(10) || 'select output from table(dbms_workload_repository.awr_global_report_text('||dbid||','||''''''||','||snap_id_prev||','||snap_id||'));' ||
                chr(10) || 'spool off'
        when 'awr_global_report_html' then
            'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'awr_report_'||dbname||'.'||'global'||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'html' ||
                chr(10) || 'select output from table(dbms_workload_repository.awr_global_report_html('||dbid||','||''''''||','||snap_id_prev||','||snap_id||'));' ||
                chr(10) || 'spool off'
        when 'ash_report_text' then
            'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'ash_report_'||dbname||'.'||instance_name||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'txt' ||
                chr(10) || 'select output from table(dbms_workload_repository.ash_report_text('||dbid||','||instance_number||','||'to_date('''||begin_interval_time||''','''||:date_format||'''),'||'to_date('''||end_interval_time||''','''||:date_format||''')));' ||
                chr(10) || 'spool off'
        when 'ash_report_html' then
            'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'ash_report_'||dbname||'.'||instance_name||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'html' ||
            chr(10) || 'select output from table(dbms_workload_repository.ash_report_html('||dbid||','||instance_number||','||'to_date('''||begin_interval_time||''','''||:date_format||'''),'||'to_date('''||end_interval_time||''','''||:date_format||''')));' ||
            chr(10) || 'spool off'
        when 'ash_global_report_text' then
            'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'ash_report_'||dbname||'.'||'global'||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'txt' ||
                chr(10) || 'select output from table(dbms_workload_repository.ash_global_report_text('||dbid||','||''''''||','||'to_date('''||begin_interval_time||''','''||:date_format||'''),'||'to_date('''||end_interval_time||''','''||:date_format||''')));' ||
                chr(10) || 'spool off'
        when 'ash_global_report_html' then
            'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'ash_report_'||dbname||'.'||'global'||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'html' ||
                chr(10) || 'select output from table(dbms_workload_repository.ash_global_report_html('||dbid||','||''''''||','||'to_date('''||begin_interval_time||''','''||:date_format||'''),'||'to_date('''||end_interval_time||''','''||:date_format||''')));' ||
                chr(10) || 'spool off'
        when 'addm_report_text' then
            'exec dbms_advisor.delete_task(task_name => '''||'ADDM_'||snap_id_prev||'_'||snap_id||'_AWR_SNAPSHOT'||''');' ||
            chr(10) || 'exec dbms_advisor.create_task(advisor_name => ''ADDM'',task_name => '''||'ADDM_'||snap_id_prev||'_'||snap_id||'_AWR_SNAPSHOT'||''',task_desc => '''||'ADDM advisor for snapshots '||snap_id_prev||' to '||snap_id||''');' ||
            chr(10) || 'exec dbms_advisor.set_task_parameter(task_name => '''||'ADDM_'||snap_id_prev||'_'||snap_id||'_AWR_SNAPSHOT'||''',parameter => ''START_SNAPSHOT'',   value => '||snap_id_prev||');' ||
            chr(10) || 'exec dbms_advisor.set_task_parameter(task_name => '''||'ADDM_'||snap_id_prev||'_'||snap_id||'_AWR_SNAPSHOT'||''',parameter => ''END_SNAPSHOT'',     value => '||snap_id||');' ||
            chr(10) || 'exec dbms_advisor.set_task_parameter(task_name => '''||'ADDM_'||snap_id_prev||'_'||snap_id||'_AWR_SNAPSHOT'||''',parameter => ''DB_ID'',            value => '||dbid||');' ||
            chr(10) || 'exec dbms_advisor.set_task_parameter(task_name => '''||'ADDM_'||snap_id_prev||'_'||snap_id||'_AWR_SNAPSHOT'||''',parameter => ''INSTANCE'',         value => '||instance_number||');' ||
            chr(10) || 'exec dbms_advisor.execute_task(task_name => '''||'ADDM_'||snap_id_prev||'_'||snap_id||'_AWR_SNAPSHOT'||''');' ||
            chr(10) || 'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'addm_report_'||dbname||'.'||instance_name||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'txt' ||
            chr(10) || 'select dbms_advisor.get_task_report('''||'ADDM_'||snap_id_prev||'_'||snap_id||'_AWR_SNAPSHOT'||''',''TEXT'',''ALL'') as report FROM    dual;' ||
            chr(10) || 'spool off'
    end  report
from (select dbname,instance_name,snap_id     ,snap_id_prev,begin_interval_time    ,end_interval_time    ,dbid,instance_number,awr_report from snaps
        union all
      select distinct dbname,instance_name,max_snap_id,min_snap_id  ,min_begin_interval_time,max_end_interval_time,dbid,instance_number,awr_report from snaps)
order by report
;

spool off

-- execute sql file
@&CREATE_SQL_FILE
set termout on

prompt
prompt
prompt
prompt All Reports Completed!

												]]></sql>
				<binds>
					<bind id="DB_NAME">
						<prompt><![CDATA[DB_NAME]]></prompt>
						<tooltip><![CDATA[DB_NAME]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="INSTANCE_NAME">
						<prompt><![CDATA[INSTANCE_NAME]]></prompt>
						<tooltip><![CDATA[INSTANCE_NAME]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="START_SNAP_DATE">
						<prompt><![CDATA[START_SNAP_DATE]]></prompt>
						<tooltip><![CDATA[START_SNAP_DATE]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="END_SNAP_DATE">
						<prompt><![CDATA[END_SNAP_DATE]]></prompt>
						<tooltip><![CDATA[END_SNAP_DATE]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="START_SNAP_ID">
						<prompt><![CDATA[START_SNAP_ID]]></prompt>
						<tooltip><![CDATA[START_SNAP_ID]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="END_SNAP_ID">
						<prompt><![CDATA[END_SNAP_ID]]></prompt>
						<tooltip><![CDATA[END_SNAP_ID]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="DBID">
						<prompt><![CDATA[DBID]]></prompt>
						<tooltip><![CDATA[DBID]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="INSTANCE_NUMBER">
						<prompt><![CDATA[INSTANCE_NUMBER]]></prompt>
						<tooltip><![CDATA[INSTANCE_NUMBER]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
				</binds>
			</query>
		</display>
		<display id="" type="" style="Script" enable="true">
			<name><![CDATA[All ASH]]></name>
			<description><![CDATA[]]></description>
			<tooltip><![CDATA[]]></tooltip>
			<drillclass><![CDATA[]]></drillclass>
			<CustomValues>
			</CustomValues>
			<query>
				<sql><![CDATA[
set echo off feedback off linesize 4000 long 100000 trimspool on pagesize 0 heading off time off timing off serveroutput on verify off termout on
--define variables
col create_sql_file new_value create_sql_file
select  :REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'create_reports.sql' create_sql_file from dual;


var date_format      varchar2(40)
exec :date_format := 'yyyy-mm-dd_hh24.mi.ss'


-- create sql file
spool "&CREATE_SQL_FILE"
prompt set echo off feedback on linesize 4000 long 100000 trimspool on pagesize 0 heading off time off timing off serveroutput on verify off termout off
with
    report_type as (
                    select 'ash_report_html'    awr_report from dual
                    ),
    db as (
                    select distinct dbid from  dba_hist_snapshot 
                    where 1=1
                        and cast(begin_interval_time as date) < to_date(:END_SNAP_DATE,'yyyy-mm-dd hh24:mi:ss')
                        and cast(end_interval_time as date)   > to_date(:START_SNAP_DATE,'yyyy-mm-dd hh24:mi:ss')
    ),
    snaps as
                (select
                    d.name  dbname
                    ,i.instance_name
                    ,s.snap_id
                    ,snap_id_prev
                    ,d.dbid
                    ,i.instance_number
                    ,to_char(s.begin_interval_time,:date_format) begin_interval_time
                    ,to_char(s.end_interval_time,:date_format)   end_interval_time
                    ,min(to_char(s.begin_interval_time,:date_format)) over (partition by rt.awr_report) min_begin_interval_time
                    ,max(to_char(s.end_interval_time,:date_format))   over (partition by rt.awr_report) max_end_interval_time
                    ,max(snap_id) over (partition by rt.awr_report)     max_snap_id
                    ,min(snap_id_prev) over(partition by rt.awr_report) min_snap_id
                    ,rt.awr_report
                from (select dhs.*,lag(snap_id) over (order by snap_id) as snap_id_prev from dba_hist_snapshot dhs, db where instance_number = :INSTANCE_NUMBER and dhs.dbid = db.dbid) s
                        ,dba_hist_database_instance di, v$database d, v$instance i, report_type rt
                where di.dbid                 = s.dbid
                    and di.dbid               = d.dbid
                    and di.instance_number    = s.instance_number
                    and di.instance_number    = i.instance_number
                    and di.startup_time       = s.startup_time
					and cast(s.begin_interval_time as date) < to_date(:END_SNAP_DATE,'yyyy-mm-dd hh24:mi:ss')
                    --and s.begin_interval_time < to_date(:end_date,:date_format)
					and cast(s.end_interval_time as date) > to_date(:START_SNAP_DATE,'yyyy-mm-dd hh24:mi:ss')
                    --and s.end_interval_time   > to_date(:start_date,:date_format)
                )
select distinct
    case awr_report
        when 'awr_report_text' then
            'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'awr_report_'||dbname||'.'||instance_name||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'txt' ||
                chr(10) || 'select output from table(dbms_workload_repository.awr_report_text('||dbid||','||instance_number||','||snap_id_prev||','||snap_id||'));' ||
                chr(10) || 'spool off'
        when 'awr_report_html' then
            'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'awr_report_'||dbname||'.'||instance_name||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'html' ||
                chr(10) || 'select output from table(dbms_workload_repository.awr_report_html('||dbid||','||instance_number||','||snap_id_prev||','||snap_id||'));' ||
                chr(10) || 'spool off'
        when 'awr_global_report_text' then
            'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'awr_report_'||dbname||'.'||'global'||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'txt' ||
                chr(10) || 'select output from table(dbms_workload_repository.awr_global_report_text('||dbid||','||''''''||','||snap_id_prev||','||snap_id||'));' ||
                chr(10) || 'spool off'
        when 'awr_global_report_html' then
            'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'awr_report_'||dbname||'.'||'global'||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'html' ||
                chr(10) || 'select output from table(dbms_workload_repository.awr_global_report_html('||dbid||','||''''''||','||snap_id_prev||','||snap_id||'));' ||
                chr(10) || 'spool off'
        when 'ash_report_text' then
            'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'ash_report_'||dbname||'.'||instance_name||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'txt' ||
                chr(10) || 'select output from table(dbms_workload_repository.ash_report_text('||dbid||','||instance_number||','||'to_date('''||begin_interval_time||''','''||:date_format||'''),'||'to_date('''||end_interval_time||''','''||:date_format||''')));' ||
                chr(10) || 'spool off'
        when 'ash_report_html' then
            'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'ash_report_'||dbname||'.'||instance_name||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'html' ||
            chr(10) || 'select output from table(dbms_workload_repository.ash_report_html('||dbid||','||instance_number||','||'to_date('''||begin_interval_time||''','''||:date_format||'''),'||'to_date('''||end_interval_time||''','''||:date_format||''')));' ||
            chr(10) || 'spool off'
        when 'ash_global_report_text' then
            'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'ash_report_'||dbname||'.'||'global'||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'txt' ||
                chr(10) || 'select output from table(dbms_workload_repository.ash_global_report_text('||dbid||','||''''''||','||'to_date('''||begin_interval_time||''','''||:date_format||'''),'||'to_date('''||end_interval_time||''','''||:date_format||''')));' ||
                chr(10) || 'spool off'
        when 'ash_global_report_html' then
            'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'ash_report_'||dbname||'.'||'global'||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'html' ||
                chr(10) || 'select output from table(dbms_workload_repository.ash_global_report_html('||dbid||','||''''''||','||'to_date('''||begin_interval_time||''','''||:date_format||'''),'||'to_date('''||end_interval_time||''','''||:date_format||''')));' ||
                chr(10) || 'spool off'
        when 'addm_report_text' then
            'exec dbms_advisor.delete_task(task_name => '''||'ADDM_'||snap_id_prev||'_'||snap_id||'_AWR_SNAPSHOT'||''');' ||
            chr(10) || 'exec dbms_advisor.create_task(advisor_name => ''ADDM'',task_name => '''||'ADDM_'||snap_id_prev||'_'||snap_id||'_AWR_SNAPSHOT'||''',task_desc => '''||'ADDM advisor for snapshots '||snap_id_prev||' to '||snap_id||''');' ||
            chr(10) || 'exec dbms_advisor.set_task_parameter(task_name => '''||'ADDM_'||snap_id_prev||'_'||snap_id||'_AWR_SNAPSHOT'||''',parameter => ''START_SNAPSHOT'',   value => '||snap_id_prev||');' ||
            chr(10) || 'exec dbms_advisor.set_task_parameter(task_name => '''||'ADDM_'||snap_id_prev||'_'||snap_id||'_AWR_SNAPSHOT'||''',parameter => ''END_SNAPSHOT'',     value => '||snap_id||');' ||
            chr(10) || 'exec dbms_advisor.set_task_parameter(task_name => '''||'ADDM_'||snap_id_prev||'_'||snap_id||'_AWR_SNAPSHOT'||''',parameter => ''DB_ID'',            value => '||dbid||');' ||
            chr(10) || 'exec dbms_advisor.set_task_parameter(task_name => '''||'ADDM_'||snap_id_prev||'_'||snap_id||'_AWR_SNAPSHOT'||''',parameter => ''INSTANCE'',         value => '||instance_number||');' ||
            chr(10) || 'exec dbms_advisor.execute_task(task_name => '''||'ADDM_'||snap_id_prev||'_'||snap_id||'_AWR_SNAPSHOT'||''');' ||
            chr(10) || 'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'addm_report_'||dbname||'.'||instance_name||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'txt' ||
            chr(10) || 'select dbms_advisor.get_task_report('''||'ADDM_'||snap_id_prev||'_'||snap_id||'_AWR_SNAPSHOT'||''',''TEXT'',''ALL'') as report FROM    dual;' ||
            chr(10) || 'spool off'
    end  report
from (select dbname,instance_name,snap_id     ,snap_id_prev,begin_interval_time    ,end_interval_time    ,dbid,instance_number,awr_report from snaps
        union all
      select distinct dbname,instance_name,max_snap_id,min_snap_id  ,min_begin_interval_time,max_end_interval_time,dbid,instance_number,awr_report from snaps)
order by report
;

spool off

-- execute sql file
@&CREATE_SQL_FILE
set termout on

prompt
prompt
prompt
prompt All Reports Completed!

												]]></sql>
				<binds>
					<bind id="DB_NAME">
						<prompt><![CDATA[DB_NAME]]></prompt>
						<tooltip><![CDATA[DB_NAME]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="INSTANCE_NAME">
						<prompt><![CDATA[INSTANCE_NAME]]></prompt>
						<tooltip><![CDATA[INSTANCE_NAME]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="START_SNAP_DATE">
						<prompt><![CDATA[START_SNAP_DATE]]></prompt>
						<tooltip><![CDATA[START_SNAP_DATE]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="END_SNAP_DATE">
						<prompt><![CDATA[END_SNAP_DATE]]></prompt>
						<tooltip><![CDATA[END_SNAP_DATE]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="START_SNAP_ID">
						<prompt><![CDATA[START_SNAP_ID]]></prompt>
						<tooltip><![CDATA[START_SNAP_ID]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="END_SNAP_ID">
						<prompt><![CDATA[END_SNAP_ID]]></prompt>
						<tooltip><![CDATA[END_SNAP_ID]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="DBID">
						<prompt><![CDATA[DBID]]></prompt>
						<tooltip><![CDATA[DBID]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="INSTANCE_NUMBER">
						<prompt><![CDATA[INSTANCE_NUMBER]]></prompt>
						<tooltip><![CDATA[INSTANCE_NUMBER]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
				</binds>
			</query>
		</display>
		<display id="" type="" style="Script" enable="true">
			<name><![CDATA[All ADDM]]></name>
			<description><![CDATA[]]></description>
			<tooltip><![CDATA[]]></tooltip>
			<drillclass><![CDATA[]]></drillclass>
			<CustomValues>
			</CustomValues>
			<query>
				<sql><![CDATA[
set echo off feedback off linesize 4000 long 100000 trimspool on pagesize 0 heading off time off timing off serveroutput on verify off termout on
--define variables
col create_sql_file new_value create_sql_file
select  :REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'create_reports.sql' create_sql_file from dual;

var date_format      varchar2(40)
exec :date_format := 'yyyy-mm-dd_hh24.mi.ss'


-- create sql file
spool "&CREATE_SQL_FILE"
prompt set echo off feedback on linesize 4000 long 100000 trimspool on pagesize 0 heading off time off timing off serveroutput on verify off termout off
with
    report_type as (
                    select 'addm_report_text'  awr_report from dual
                    ),
    db as (
                    select distinct dbid from  dba_hist_snapshot 
                    where 1=1
                        and cast(begin_interval_time as date) < to_date(:END_SNAP_DATE,'yyyy-mm-dd hh24:mi:ss')
                        and cast(end_interval_time as date)   > to_date(:START_SNAP_DATE,'yyyy-mm-dd hh24:mi:ss')
    ),
    snaps as
                (select
                    d.name  dbname
                    ,i.instance_name
                    ,s.snap_id
                    ,snap_id_prev
                    ,d.dbid
                    ,i.instance_number
                    ,to_char(s.begin_interval_time,:date_format) begin_interval_time
                    ,to_char(s.end_interval_time,:date_format)   end_interval_time
                    ,min(to_char(s.begin_interval_time,:date_format)) over (partition by rt.awr_report) min_begin_interval_time
                    ,max(to_char(s.end_interval_time,:date_format))   over (partition by rt.awr_report) max_end_interval_time
                    ,max(snap_id) over (partition by rt.awr_report)     max_snap_id
                    ,min(snap_id_prev) over(partition by rt.awr_report) min_snap_id
                    ,rt.awr_report
                from (select dhs.*,lag(snap_id) over (order by snap_id) as snap_id_prev from dba_hist_snapshot dhs, db where instance_number = :INSTANCE_NUMBER and dhs.dbid = db.dbid) s
                        ,dba_hist_database_instance di, v$database d, v$instance i, report_type rt
                where di.dbid                 = s.dbid
                    and di.dbid               = d.dbid
                    and di.instance_number    = s.instance_number
                    and di.instance_number    = i.instance_number
                    and di.startup_time       = s.startup_time
					and cast(s.begin_interval_time as date) < to_date(:END_SNAP_DATE,'yyyy-mm-dd hh24:mi:ss')
                    --and s.begin_interval_time < to_date(:end_date,:date_format)
					and cast(s.end_interval_time as date) > to_date(:START_SNAP_DATE,'yyyy-mm-dd hh24:mi:ss')
                    --and s.end_interval_time   > to_date(:start_date,:date_format)
                )
select distinct
    case awr_report
        when 'awr_report_text' then
            'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'awr_report_'||dbname||'.'||instance_name||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'txt' ||
                chr(10) || 'select output from table(dbms_workload_repository.awr_report_text('||dbid||','||instance_number||','||snap_id_prev||','||snap_id||'));' ||
                chr(10) || 'spool off'
        when 'awr_report_html' then
            'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'awr_report_'||dbname||'.'||instance_name||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'html' ||
                chr(10) || 'select output from table(dbms_workload_repository.awr_report_html('||dbid||','||instance_number||','||snap_id_prev||','||snap_id||'));' ||
                chr(10) || 'spool off'
        when 'awr_global_report_text' then
            'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'awr_report_'||dbname||'.'||'global'||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'txt' ||
                chr(10) || 'select output from table(dbms_workload_repository.awr_global_report_text('||dbid||','||''''''||','||snap_id_prev||','||snap_id||'));' ||
                chr(10) || 'spool off'
        when 'awr_global_report_html' then
            'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'awr_report_'||dbname||'.'||'global'||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'html' ||
                chr(10) || 'select output from table(dbms_workload_repository.awr_global_report_html('||dbid||','||''''''||','||snap_id_prev||','||snap_id||'));' ||
                chr(10) || 'spool off'
        when 'ash_report_text' then
            'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'ash_report_'||dbname||'.'||instance_name||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'txt' ||
                chr(10) || 'select output from table(dbms_workload_repository.ash_report_text('||dbid||','||instance_number||','||'to_date('''||begin_interval_time||''','''||:date_format||'''),'||'to_date('''||end_interval_time||''','''||:date_format||''')));' ||
                chr(10) || 'spool off'
        when 'ash_report_html' then
            'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'ash_report_'||dbname||'.'||instance_name||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'html' ||
            chr(10) || 'select output from table(dbms_workload_repository.ash_report_html('||dbid||','||instance_number||','||'to_date('''||begin_interval_time||''','''||:date_format||'''),'||'to_date('''||end_interval_time||''','''||:date_format||''')));' ||
            chr(10) || 'spool off'
        when 'ash_global_report_text' then
            'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'ash_report_'||dbname||'.'||'global'||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'txt' ||
                chr(10) || 'select output from table(dbms_workload_repository.ash_global_report_text('||dbid||','||''''''||','||'to_date('''||begin_interval_time||''','''||:date_format||'''),'||'to_date('''||end_interval_time||''','''||:date_format||''')));' ||
                chr(10) || 'spool off'
        when 'ash_global_report_html' then
            'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'ash_report_'||dbname||'.'||'global'||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'html' ||
                chr(10) || 'select output from table(dbms_workload_repository.ash_global_report_html('||dbid||','||''''''||','||'to_date('''||begin_interval_time||''','''||:date_format||'''),'||'to_date('''||end_interval_time||''','''||:date_format||''')));' ||
                chr(10) || 'spool off'
        when 'addm_report_text' then
            'exec dbms_advisor.delete_task(task_name => '''||'ADDM_'||snap_id_prev||'_'||snap_id||'_AWR_SNAPSHOT'||''');' ||
            chr(10) || 'exec dbms_advisor.create_task(advisor_name => ''ADDM'',task_name => '''||'ADDM_'||snap_id_prev||'_'||snap_id||'_AWR_SNAPSHOT'||''',task_desc => '''||'ADDM advisor for snapshots '||snap_id_prev||' to '||snap_id||''');' ||
            chr(10) || 'exec dbms_advisor.set_task_parameter(task_name => '''||'ADDM_'||snap_id_prev||'_'||snap_id||'_AWR_SNAPSHOT'||''',parameter => ''START_SNAPSHOT'',   value => '||snap_id_prev||');' ||
            chr(10) || 'exec dbms_advisor.set_task_parameter(task_name => '''||'ADDM_'||snap_id_prev||'_'||snap_id||'_AWR_SNAPSHOT'||''',parameter => ''END_SNAPSHOT'',     value => '||snap_id||');' ||
            chr(10) || 'exec dbms_advisor.set_task_parameter(task_name => '''||'ADDM_'||snap_id_prev||'_'||snap_id||'_AWR_SNAPSHOT'||''',parameter => ''DB_ID'',            value => '||dbid||');' ||
            chr(10) || 'exec dbms_advisor.set_task_parameter(task_name => '''||'ADDM_'||snap_id_prev||'_'||snap_id||'_AWR_SNAPSHOT'||''',parameter => ''INSTANCE'',         value => '||instance_number||');' ||
            chr(10) || 'exec dbms_advisor.execute_task(task_name => '''||'ADDM_'||snap_id_prev||'_'||snap_id||'_AWR_SNAPSHOT'||''');' ||
            chr(10) || 'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'addm_report_'||dbname||'.'||instance_name||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'txt' ||
            chr(10) || 'select dbms_advisor.get_task_report('''||'ADDM_'||snap_id_prev||'_'||snap_id||'_AWR_SNAPSHOT'||''',''TEXT'',''ALL'') as report FROM    dual;' ||
            chr(10) || 'spool off'
    end  report
from (select dbname,instance_name,snap_id     ,snap_id_prev,begin_interval_time    ,end_interval_time    ,dbid,instance_number,awr_report from snaps
        union all
      select distinct dbname,instance_name,max_snap_id,min_snap_id  ,min_begin_interval_time,max_end_interval_time,dbid,instance_number,awr_report from snaps)
order by report
;

spool off

-- execute sql file
@&CREATE_SQL_FILE
set termout on

prompt
prompt
prompt
prompt All Reports Completed!

												]]></sql>
				<binds>
					<bind id="DB_NAME">
						<prompt><![CDATA[DB_NAME]]></prompt>
						<tooltip><![CDATA[DB_NAME]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="INSTANCE_NAME">
						<prompt><![CDATA[INSTANCE_NAME]]></prompt>
						<tooltip><![CDATA[INSTANCE_NAME]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="START_SNAP_DATE">
						<prompt><![CDATA[START_SNAP_DATE]]></prompt>
						<tooltip><![CDATA[START_SNAP_DATE]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="END_SNAP_DATE">
						<prompt><![CDATA[END_SNAP_DATE]]></prompt>
						<tooltip><![CDATA[END_SNAP_DATE]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="START_SNAP_ID">
						<prompt><![CDATA[START_SNAP_ID]]></prompt>
						<tooltip><![CDATA[START_SNAP_ID]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="END_SNAP_ID">
						<prompt><![CDATA[END_SNAP_ID]]></prompt>
						<tooltip><![CDATA[END_SNAP_ID]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="DBID">
						<prompt><![CDATA[DBID]]></prompt>
						<tooltip><![CDATA[DBID]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="INSTANCE_NUMBER">
						<prompt><![CDATA[INSTANCE_NUMBER]]></prompt>
						<tooltip><![CDATA[INSTANCE_NUMBER]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
				</binds>
			</query>
		</display>
		<display id="" type="" style="Script" enable="true">
			<name><![CDATA[All Standalone]]></name>
			<description><![CDATA[]]></description>
			<tooltip><![CDATA[]]></tooltip>
			<drillclass><![CDATA[]]></drillclass>
			<CustomValues>
			</CustomValues>
			<query>
				<sql><![CDATA[
set echo off feedback off linesize 4000 long 100000 trimspool on pagesize 0 heading off time off timing off serveroutput on verify off termout on
--define variables
col create_sql_file new_value create_sql_file
select  :REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'create_reports.sql' create_sql_file from dual;

var date_format      varchar2(40)
exec :date_format := 'yyyy-mm-dd_hh24.mi.ss'


-- create sql file
spool "&CREATE_SQL_FILE"
prompt set echo off feedback on linesize 4000 long 100000 trimspool on pagesize 0 heading off time off timing off serveroutput on verify off termout off
with
    report_type as (
                select 'awr_report_html' awr_report from dual union all
                select 'ash_report_html'            from dual union all
                select 'addm_report_text'    from dual
                    ),
    db as (
                    select distinct dbid from  dba_hist_snapshot 
                    where 1=1
                        and cast(begin_interval_time as date) < to_date(:END_SNAP_DATE,'yyyy-mm-dd hh24:mi:ss')
                        and cast(end_interval_time as date)   > to_date(:START_SNAP_DATE,'yyyy-mm-dd hh24:mi:ss')
    ),
    snaps as
                (select
                    d.name  dbname
                    ,i.instance_name
                    ,s.snap_id
                    ,snap_id_prev
                    ,d.dbid
                    ,i.instance_number
                    ,to_char(s.begin_interval_time,:date_format) begin_interval_time
                    ,to_char(s.end_interval_time,:date_format)   end_interval_time
                    ,min(to_char(s.begin_interval_time,:date_format)) over (partition by rt.awr_report) min_begin_interval_time
                    ,max(to_char(s.end_interval_time,:date_format))   over (partition by rt.awr_report) max_end_interval_time
                    ,max(snap_id) over (partition by rt.awr_report)     max_snap_id
                    ,min(snap_id_prev) over(partition by rt.awr_report) min_snap_id
                    ,rt.awr_report
                from (select dhs.*,lag(snap_id) over (order by snap_id) as snap_id_prev from dba_hist_snapshot dhs, db where instance_number = :INSTANCE_NUMBER and dhs.dbid = db.dbid) s
                        ,dba_hist_database_instance di, v$database d, v$instance i, report_type rt
                where di.dbid                 = s.dbid
                    and di.dbid               = d.dbid
                    and di.instance_number    = s.instance_number
                    and di.instance_number    = i.instance_number
                    and di.startup_time       = s.startup_time
					and cast(s.begin_interval_time as date) < to_date(:END_SNAP_DATE,'yyyy-mm-dd hh24:mi:ss')
                    --and s.begin_interval_time < to_date(:end_date,:date_format)
					and cast(s.end_interval_time as date) > to_date(:START_SNAP_DATE,'yyyy-mm-dd hh24:mi:ss')
                    --and s.end_interval_time   > to_date(:start_date,:date_format)
                )
select distinct
    case awr_report
        when 'awr_report_text' then
            'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'awr_report_'||dbname||'.'||instance_name||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'txt' ||
                chr(10) || 'select output from table(dbms_workload_repository.awr_report_text('||dbid||','||instance_number||','||snap_id_prev||','||snap_id||'));' ||
                chr(10) || 'spool off'
        when 'awr_report_html' then
            'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'awr_report_'||dbname||'.'||instance_name||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'html' ||
                chr(10) || 'select output from table(dbms_workload_repository.awr_report_html('||dbid||','||instance_number||','||snap_id_prev||','||snap_id||'));' ||
                chr(10) || 'spool off'
        when 'awr_global_report_text' then
            'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'awr_report_'||dbname||'.'||'global'||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'txt' ||
                chr(10) || 'select output from table(dbms_workload_repository.awr_global_report_text('||dbid||','||''''''||','||snap_id_prev||','||snap_id||'));' ||
                chr(10) || 'spool off'
        when 'awr_global_report_html' then
            'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'awr_report_'||dbname||'.'||'global'||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'html' ||
                chr(10) || 'select output from table(dbms_workload_repository.awr_global_report_html('||dbid||','||''''''||','||snap_id_prev||','||snap_id||'));' ||
                chr(10) || 'spool off'
        when 'ash_report_text' then
            'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'ash_report_'||dbname||'.'||instance_name||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'txt' ||
                chr(10) || 'select output from table(dbms_workload_repository.ash_report_text('||dbid||','||instance_number||','||'to_date('''||begin_interval_time||''','''||:date_format||'''),'||'to_date('''||end_interval_time||''','''||:date_format||''')));' ||
                chr(10) || 'spool off'
        when 'ash_report_html' then
            'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'ash_report_'||dbname||'.'||instance_name||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'html' ||
            chr(10) || 'select output from table(dbms_workload_repository.ash_report_html('||dbid||','||instance_number||','||'to_date('''||begin_interval_time||''','''||:date_format||'''),'||'to_date('''||end_interval_time||''','''||:date_format||''')));' ||
            chr(10) || 'spool off'
        when 'ash_global_report_text' then
            'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'ash_report_'||dbname||'.'||'global'||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'txt' ||
                chr(10) || 'select output from table(dbms_workload_repository.ash_global_report_text('||dbid||','||''''''||','||'to_date('''||begin_interval_time||''','''||:date_format||'''),'||'to_date('''||end_interval_time||''','''||:date_format||''')));' ||
                chr(10) || 'spool off'
        when 'ash_global_report_html' then
            'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'ash_report_'||dbname||'.'||'global'||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'html' ||
                chr(10) || 'select output from table(dbms_workload_repository.ash_global_report_html('||dbid||','||''''''||','||'to_date('''||begin_interval_time||''','''||:date_format||'''),'||'to_date('''||end_interval_time||''','''||:date_format||''')));' ||
                chr(10) || 'spool off'
        when 'addm_report_text' then
            'exec dbms_advisor.delete_task(task_name => '''||'ADDM_'||snap_id_prev||'_'||snap_id||'_AWR_SNAPSHOT'||''');' ||
            chr(10) || 'exec dbms_advisor.create_task(advisor_name => ''ADDM'',task_name => '''||'ADDM_'||snap_id_prev||'_'||snap_id||'_AWR_SNAPSHOT'||''',task_desc => '''||'ADDM advisor for snapshots '||snap_id_prev||' to '||snap_id||''');' ||
            chr(10) || 'exec dbms_advisor.set_task_parameter(task_name => '''||'ADDM_'||snap_id_prev||'_'||snap_id||'_AWR_SNAPSHOT'||''',parameter => ''START_SNAPSHOT'',   value => '||snap_id_prev||');' ||
            chr(10) || 'exec dbms_advisor.set_task_parameter(task_name => '''||'ADDM_'||snap_id_prev||'_'||snap_id||'_AWR_SNAPSHOT'||''',parameter => ''END_SNAPSHOT'',     value => '||snap_id||');' ||
            chr(10) || 'exec dbms_advisor.set_task_parameter(task_name => '''||'ADDM_'||snap_id_prev||'_'||snap_id||'_AWR_SNAPSHOT'||''',parameter => ''DB_ID'',            value => '||dbid||');' ||
            chr(10) || 'exec dbms_advisor.set_task_parameter(task_name => '''||'ADDM_'||snap_id_prev||'_'||snap_id||'_AWR_SNAPSHOT'||''',parameter => ''INSTANCE'',         value => '||instance_number||');' ||
            chr(10) || 'exec dbms_advisor.execute_task(task_name => '''||'ADDM_'||snap_id_prev||'_'||snap_id||'_AWR_SNAPSHOT'||''');' ||
            chr(10) || 'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'addm_report_'||dbname||'.'||instance_name||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'txt' ||
            chr(10) || 'select dbms_advisor.get_task_report('''||'ADDM_'||snap_id_prev||'_'||snap_id||'_AWR_SNAPSHOT'||''',''TEXT'',''ALL'') as report FROM    dual;' ||
            chr(10) || 'spool off'
    end  report
from (select dbname,instance_name,snap_id     ,snap_id_prev,begin_interval_time    ,end_interval_time    ,dbid,instance_number,awr_report from snaps
        union all
      select distinct dbname,instance_name,max_snap_id,min_snap_id  ,min_begin_interval_time,max_end_interval_time,dbid,instance_number,awr_report from snaps)
order by report
;

spool off

-- execute sql file
@&CREATE_SQL_FILE
set termout on

prompt
prompt
prompt
prompt All Reports Completed!

												]]></sql>
				<binds>
					<bind id="DB_NAME">
						<prompt><![CDATA[DB_NAME]]></prompt>
						<tooltip><![CDATA[DB_NAME]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="INSTANCE_NAME">
						<prompt><![CDATA[INSTANCE_NAME]]></prompt>
						<tooltip><![CDATA[INSTANCE_NAME]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="START_SNAP_DATE">
						<prompt><![CDATA[START_SNAP_DATE]]></prompt>
						<tooltip><![CDATA[START_SNAP_DATE]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="END_SNAP_DATE">
						<prompt><![CDATA[END_SNAP_DATE]]></prompt>
						<tooltip><![CDATA[END_SNAP_DATE]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="START_SNAP_ID">
						<prompt><![CDATA[START_SNAP_ID]]></prompt>
						<tooltip><![CDATA[START_SNAP_ID]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="END_SNAP_ID">
						<prompt><![CDATA[END_SNAP_ID]]></prompt>
						<tooltip><![CDATA[END_SNAP_ID]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="DBID">
						<prompt><![CDATA[DBID]]></prompt>
						<tooltip><![CDATA[DBID]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="INSTANCE_NUMBER">
						<prompt><![CDATA[INSTANCE_NUMBER]]></prompt>
						<tooltip><![CDATA[INSTANCE_NUMBER]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
				</binds>
			</query>
		</display>
		<display id="" type="" style="Script" enable="true">
			<name><![CDATA[RAC awr ash addm ]]></name>
			<description><![CDATA[]]></description>
			<tooltip><![CDATA[]]></tooltip>
			<drillclass><![CDATA[]]></drillclass>
			<CustomValues>
			</CustomValues>
			<query>
				<sql><![CDATA[
prompt Running....
--AWR
set echo off feedback on linesize 4000 long 100000 trimspool on pagesize 0 heading off time off timing off serveroutput on verify off termout off
column filename new_value filename
select  :REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'awr_report_'||:DB_NAME||'.'||:INSTANCE_NAME||'.'||:START_SNAP_DATE||'--'||:END_SNAP_DATE||'.'||:START_SNAP_ID||'-'||:END_SNAP_ID||'.html' filename from dual;
spool &filename
select output from table(dbms_workload_repository.awr_global_report_html(:DBID,'',:START_SNAP_ID,:END_SNAP_ID));
spool off
set termout on heading on feedback off
prompt &filename

--ASH
set echo off feedback on linesize 4000 long 100000 trimspool on pagesize 0 heading off time off timing off serveroutput on verify off termout off
column filename new_value filename
select  :REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'ash_report_'||:DB_NAME||'.'||:INSTANCE_NAME||'.'||:START_SNAP_DATE||'--'||:END_SNAP_DATE||'.'||:START_SNAP_ID||'-'||:END_SNAP_ID||'.html' filename from dual;
spool &filename
select output from table(dbms_workload_repository.ash_global_report_html(:DBID,'',to_date(:START_SNAP_DATE,'yyyy-mm-dd hh24:mi:ss'),to_date(:END_SNAP_DATE,'yyyy-mm-dd_hh24.mi.ss')));
spool off
set termout on heading on feedback off
prompt &filename

-ADDM
set echo off feedback on linesize 4000 long 100000 trimspool on pagesize 0 heading off time off timing off serveroutput on verify off termout off
column filename new_value filename
select :REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'addm_report_'||:DB_NAME||'.'||'global'||'.'||:START_SNAP_DATE||'--'||:END_SNAP_DATE||'.'||:START_SNAP_ID||'-'||:END_SNAP_ID||'.'||'txt' filename from dual;
exec dbms_advisor.delete_task(task_name => 'ADDM_'||:START_SNAP_ID||'_'||:END_SNAP_ID||'_AWR_SNAPSHOT');
exec dbms_advisor.create_task(advisor_name => 'ADDM', task_name => 'ADDM_'||:START_SNAP_ID||'_'||:END_SNAP_ID||'_AWR_SNAPSHOT',task_desc => 'ADDM advisor for snapshots '||:START_SNAP_ID||' to '||:END_SNAP_ID);
exec dbms_advisor.set_task_parameter(task_name => 'ADDM_'||:START_SNAP_ID||'_'||:END_SNAP_ID||'_AWR_SNAPSHOT',parameter => 'START_SNAPSHOT',   value => :START_SNAP_ID);
exec dbms_advisor.set_task_parameter(task_name => 'ADDM_'||:START_SNAP_ID||'_'||:END_SNAP_ID||'_AWR_SNAPSHOT',parameter => 'END_SNAPSHOT',     value => :END_SNAP_ID);
exec dbms_advisor.set_task_parameter(task_name => 'ADDM_'||:START_SNAP_ID||'_'||:END_SNAP_ID||'_AWR_SNAPSHOT',parameter => 'DB_ID',            value => :DBID);
exec dbms_advisor.execute_task(task_name =>  'ADDM_'||:START_SNAP_ID||'_'||:END_SNAP_ID||'_AWR_SNAPSHOT');
spool &filename
select dbms_advisor.get_task_report('ADDM_'||:START_SNAP_ID||'_'||:END_SNAP_ID||'_AWR_SNAPSHOT','TEXT','ALL') as report from dual;
spool off
set termout on heading on feedback off
prompt &filename

prompt All Reports Completed!

												]]></sql>
				<binds>
					<bind id="DB_NAME">
						<prompt><![CDATA[DB_NAME]]></prompt>
						<tooltip><![CDATA[DB_NAME]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="INSTANCE_NAME">
						<prompt><![CDATA[INSTANCE_NAME]]></prompt>
						<tooltip><![CDATA[INSTANCE_NAME]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="START_SNAP_DATE">
						<prompt><![CDATA[START_SNAP_DATE]]></prompt>
						<tooltip><![CDATA[START_SNAP_DATE]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="END_SNAP_DATE">
						<prompt><![CDATA[END_SNAP_DATE]]></prompt>
						<tooltip><![CDATA[END_SNAP_DATE]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="START_SNAP_ID">
						<prompt><![CDATA[START_SNAP_ID]]></prompt>
						<tooltip><![CDATA[START_SNAP_ID]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="END_SNAP_ID">
						<prompt><![CDATA[END_SNAP_ID]]></prompt>
						<tooltip><![CDATA[END_SNAP_ID]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="DBID">
						<prompt><![CDATA[DBID]]></prompt>
						<tooltip><![CDATA[DBID]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="INSTANCE_NUMBER">
						<prompt><![CDATA[INSTANCE_NUMBER]]></prompt>
						<tooltip><![CDATA[INSTANCE_NUMBER]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
				</binds>
			</query>
		</display>
		<display id="" type="" style="Script" enable="true">
			<name><![CDATA[All RAC]]></name>
			<description><![CDATA[]]></description>
			<tooltip><![CDATA[]]></tooltip>
			<drillclass><![CDATA[]]></drillclass>
			<CustomValues>
			</CustomValues>
			<query>
				<sql><![CDATA[
set echo off feedback off linesize 4000 long 100000 trimspool on pagesize 0 heading off time off timing off serveroutput on verify off termout on
--define variables
col create_sql_file new_value create_sql_file
select  :REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'create_reports.sql' create_sql_file from dual;

var date_format      varchar2(40)
exec :date_format := 'yyyy-mm-dd_hh24.mi.ss'


-- create sql file
spool "&CREATE_SQL_FILE"
prompt set echo off feedback on linesize 4000 long 100000 trimspool on pagesize 0 heading off time off timing off serveroutput on verify off termout off
with
    report_type as (
                select 'awr_global_report_html' awr_report from dual union all
                select 'ash_global_report_html'            from dual union all
                select 'addm_global_report_text'           from dual
                    ),
    db as (
                    select distinct dbid from  dba_hist_snapshot 
                    where 1=1
                        and cast(begin_interval_time as date) < to_date(:END_SNAP_DATE,'yyyy-mm-dd hh24:mi:ss')
                        and cast(end_interval_time as date)   > to_date(:START_SNAP_DATE,'yyyy-mm-dd hh24:mi:ss')
    ),
    snaps as
                (select
                    d.name  dbname
                    ,i.instance_name
                    ,s.snap_id
                    ,snap_id_prev
                    ,d.dbid
                    ,i.instance_number
                    ,to_char(s.begin_interval_time,:date_format) begin_interval_time
                    ,to_char(s.end_interval_time,:date_format)   end_interval_time
                    ,min(to_char(s.begin_interval_time,:date_format)) over (partition by rt.awr_report) min_begin_interval_time
                    ,max(to_char(s.end_interval_time,:date_format))   over (partition by rt.awr_report) max_end_interval_time
                    ,max(snap_id) over (partition by rt.awr_report)     max_snap_id
                    ,min(snap_id_prev) over(partition by rt.awr_report) min_snap_id
                    ,rt.awr_report
                from (select dhs.*,lag(snap_id) over (order by snap_id) as snap_id_prev from dba_hist_snapshot dhs, db where instance_number = :INSTANCE_NUMBER and dhs.dbid = db.dbid) s
                        ,dba_hist_database_instance di, v$database d, v$instance i, report_type rt
                where di.dbid                 = s.dbid
                    and di.dbid               = d.dbid
                    and di.instance_number    = s.instance_number
                    and di.instance_number    = i.instance_number
                    and di.startup_time       = s.startup_time
					and cast(s.begin_interval_time as date) < to_date(:END_SNAP_DATE,'yyyy-mm-dd hh24:mi:ss')
                    --and s.begin_interval_time < to_date(:end_date,:date_format)
					and cast(s.end_interval_time as date) > to_date(:START_SNAP_DATE,'yyyy-mm-dd hh24:mi:ss')
                    --and s.end_interval_time   > to_date(:start_date,:date_format)
                )
select distinct
    case awr_report
        when 'awr_report_text' then
            'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'awr_report_'||dbname||'.'||instance_name||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'txt' ||
                chr(10) || 'select output from table(dbms_workload_repository.awr_report_text('||dbid||','||instance_number||','||snap_id_prev||','||snap_id||'));' ||
                chr(10) || 'spool off'
        when 'awr_report_html' then
            'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'awr_report_'||dbname||'.'||instance_name||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'html' ||
                chr(10) || 'select output from table(dbms_workload_repository.awr_report_html('||dbid||','||instance_number||','||snap_id_prev||','||snap_id||'));' ||
                chr(10) || 'spool off'
        when 'awr_global_report_text' then
            'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'awr_report_'||dbname||'.'||'global'||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'txt' ||
                chr(10) || 'select output from table(dbms_workload_repository.awr_global_report_text('||dbid||','||''''''||','||snap_id_prev||','||snap_id||'));' ||
                chr(10) || 'spool off'
        when 'awr_global_report_html' then
            'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'awr_report_'||dbname||'.'||'global'||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'html' ||
                chr(10) || 'select output from table(dbms_workload_repository.awr_global_report_html('||dbid||','||''''''||','||snap_id_prev||','||snap_id||'));' ||
                chr(10) || 'spool off'
        when 'ash_report_text' then
            'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'ash_report_'||dbname||'.'||instance_name||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'txt' ||
                chr(10) || 'select output from table(dbms_workload_repository.ash_report_text('||dbid||','||instance_number||','||'to_date('''||begin_interval_time||''','''||:date_format||'''),'||'to_date('''||end_interval_time||''','''||:date_format||''')));' ||
                chr(10) || 'spool off'
        when 'ash_report_html' then
            'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'ash_report_'||dbname||'.'||instance_name||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'html' ||
            chr(10) || 'select output from table(dbms_workload_repository.ash_report_html('||dbid||','||instance_number||','||'to_date('''||begin_interval_time||''','''||:date_format||'''),'||'to_date('''||end_interval_time||''','''||:date_format||''')));' ||
            chr(10) || 'spool off'
        when 'ash_global_report_text' then
            'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'ash_report_'||dbname||'.'||'global'||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'txt' ||
                chr(10) || 'select output from table(dbms_workload_repository.ash_global_report_text('||dbid||','||''''''||','||'to_date('''||begin_interval_time||''','''||:date_format||'''),'||'to_date('''||end_interval_time||''','''||:date_format||''')));' ||
                chr(10) || 'spool off'
        when 'ash_global_report_html' then
            'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'ash_report_'||dbname||'.'||'global'||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'html' ||
                chr(10) || 'select output from table(dbms_workload_repository.ash_global_report_html('||dbid||','||''''''||','||'to_date('''||begin_interval_time||''','''||:date_format||'''),'||'to_date('''||end_interval_time||''','''||:date_format||''')));' ||
                chr(10) || 'spool off'
        when 'addm_global_report_text' then
            'exec dbms_advisor.delete_task(task_name => '''||'ADDM_'||snap_id_prev||'_'||snap_id||'_AWR_SNAPSHOT'||''');' ||
            chr(10) || 'exec dbms_advisor.create_task(advisor_name => ''ADDM'',task_name => '''||'ADDM_'||snap_id_prev||'_'||snap_id||'_AWR_SNAPSHOT'||''',task_desc => '''||'ADDM advisor for snapshots '||snap_id_prev||' to '||snap_id||''');' ||
            chr(10) || 'exec dbms_advisor.set_task_parameter(task_name => '''||'ADDM_'||snap_id_prev||'_'||snap_id||'_AWR_SNAPSHOT'||''',parameter => ''START_SNAPSHOT'',   value => '||snap_id_prev||');' ||
            chr(10) || 'exec dbms_advisor.set_task_parameter(task_name => '''||'ADDM_'||snap_id_prev||'_'||snap_id||'_AWR_SNAPSHOT'||''',parameter => ''END_SNAPSHOT'',     value => '||snap_id||');' ||
            chr(10) || 'exec dbms_advisor.set_task_parameter(task_name => '''||'ADDM_'||snap_id_prev||'_'||snap_id||'_AWR_SNAPSHOT'||''',parameter => ''DB_ID'',            value => '||dbid||');' ||
            chr(10) || 'exec dbms_advisor.execute_task(task_name => '''||'ADDM_'||snap_id_prev||'_'||snap_id||'_AWR_SNAPSHOT'||''');' ||
            chr(10) || 'spool '||:REPORTS_DEST_DIR||case when instr(:REPORTS_DEST_DIR,'\') > 0 then '\' else '/' end||'addm_report_'||dbname||'.'||'global'||'.'||begin_interval_time||'--'||end_interval_time||'.'||snap_id_prev||'-'||snap_id||'.'||'txt' ||
            chr(10) || 'select dbms_advisor.get_task_report('''||'ADDM_'||snap_id_prev||'_'||snap_id||'_AWR_SNAPSHOT'||''',''TEXT'',''ALL'') as report FROM    dual;' ||
            chr(10) || 'spool off'
    end  report
from (select dbname,instance_name,snap_id     ,snap_id_prev,begin_interval_time    ,end_interval_time    ,dbid,instance_number,awr_report from snaps
        union all
      select distinct dbname,instance_name,max_snap_id,min_snap_id  ,min_begin_interval_time,max_end_interval_time,dbid,instance_number,awr_report from snaps)
order by report
;

spool off

-- execute sql file
@&CREATE_SQL_FILE
set termout on

prompt
prompt
prompt
prompt All Reports Completed!

												]]></sql>
				<binds>
					<bind id="DB_NAME">
						<prompt><![CDATA[DB_NAME]]></prompt>
						<tooltip><![CDATA[DB_NAME]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="INSTANCE_NAME">
						<prompt><![CDATA[INSTANCE_NAME]]></prompt>
						<tooltip><![CDATA[INSTANCE_NAME]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="START_SNAP_DATE">
						<prompt><![CDATA[START_SNAP_DATE]]></prompt>
						<tooltip><![CDATA[START_SNAP_DATE]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="END_SNAP_DATE">
						<prompt><![CDATA[END_SNAP_DATE]]></prompt>
						<tooltip><![CDATA[END_SNAP_DATE]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="START_SNAP_ID">
						<prompt><![CDATA[START_SNAP_ID]]></prompt>
						<tooltip><![CDATA[START_SNAP_ID]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="END_SNAP_ID">
						<prompt><![CDATA[END_SNAP_ID]]></prompt>
						<tooltip><![CDATA[END_SNAP_ID]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="DBID">
						<prompt><![CDATA[DBID]]></prompt>
						<tooltip><![CDATA[DBID]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
					<bind id="INSTANCE_NUMBER">
						<prompt><![CDATA[INSTANCE_NUMBER]]></prompt>
						<tooltip><![CDATA[INSTANCE_NUMBER]]></tooltip>
						<value><![CDATA[NULL_VALUE]]></value>
						<bracket><![CDATA[null]]></bracket>
					</bind>
				</binds>
			</query>
		</display>
	</display>
</display>
</displays>
